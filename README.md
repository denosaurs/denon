# ![denon](./.assets/denon-horizontal.svg)

[![stars](https://img.shields.io/github/stars/denosaurs/denon?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAEFCu8CAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAHKADAAQAAAABAAAAHAAAAABHddaYAAABxElEQVRIDe2Wv04CQRDGAQuoTKQ2ITyADZWVJZWV+gJYWBNqKh/C16CRBlprWxsTE2NJfABNOH9z7Gzm2Nv7A8TCOMnHzs1838ze3e4ejUbMkiRZS64lP1x8MjTFr2DQE6Gl2nI+7POARXAmdbas44ku8eLGhU9UckRliX6qxM9sQvz0vrcVaaKJKdsSNO7LOtK1kvcbaXVRu4LMz9kgKoYwBq/KLBi/yC2DQgSnBaLMQ88Tx7Q3AVkDKHpgBdoak5HrCSjuaAW/6zOz+u/Q3ZfcVrhliuaPYCAqsSJekIO/TlWbn2BveAH5JZBVUWayusZW2ClTuPzMi6xTIp5abuBHxHLcZSyzkxHF1uNJRrV9gXBhOl7h6wFW/FqcaGILEmsDWfg9G//3858Az0lWaHhm5dP3i9JoDtTm+1UrUdMl72OZv10itfx3zOYpLAv/FPQNLvFj35Bnco/gzeCD72H6b4JYaDTpgidwaJOa3bCji5BsgYcDdJUamSMi2lQTCEbgu0Zz4Y5UX3tE3K/RTKny3qNWdst3UWU8sYtmU40py2Go9o5zC460l/guJjm1leZrjaiH4B4cVxUK12mGVTV/j/cDqcFClUX01ZEAAAAASUVORK5CYII=)](https://github.com/denosaurs/denon/stargazers)
[![workflow](https://img.shields.io/github/workflow/status/denosaurs/denon/CI%20check?logo=github)](https://github.com/denosaurs/denon/actions)
[![releases](https://img.shields.io/github/v/release/denosaurs/denon?logo=github)](https://github.com/denosaurs/denon/releases/latest/)
[![deno version](https://img.shields.io/badge/deno-^1.2.0-informational?logo=deno)](https://github.com/denoland/deno)
[![deno doc](https://img.shields.io/badge/deno-doc-informational?logo=deno)](https://doc.deno.land/https/deno.land/x/denon/mod.ts)
[![discord](https://img.shields.io/discord/713043818806509608?logo=discord&logoColor=white)](https://discord.gg/shHG8vg)
[![license](https://img.shields.io/github/license/denosaurs/denon?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAEFCu8CAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAHKADAAQAAAABAAAAHAAAAABHddaYAAAC5UlEQVRIDd2WPWtVQRCGby5pVASLiGghQSxyG8Ui2KWwCfkH9olY2JneQkiR0oCIxH/gB+qVFDYBIWBAbAIRSbCRpLXwIxLiPT7vnNm9e87ZxJtUwYH3zO47Mzv7Mbv3tlo5KYriGtgAJ81OY1ENdG/YI4boFEOI911BXgY/pdtwGuAtXpvmB1tAXHDnUolE5urkPOQo6MqA3pXWmJJL4Bb4rQ7yEYfxsjnIF29NJIoNC6e5fxOL/qN+9KCz7AaLpN8zI415N2i2EptpGrkRIjGeAuvR6IY1hSFLFUOug9Ms2M7ZxIUNytm1mnME186sdI2BOCwAyQMg54ugzSmKmwbPwSbolKH+hbAtQdsOoF+BsF3anUVwBdiOWRidFZDKTTrKEAJTm3GVrGkHzw/uPZbyx7DNNLfB7KGmRsCcr+/gjaiPSpAOTyX9qG4L/XBDdWXDDf1M+wtQ5fwCOtcb4Dto6VpLmzByB6gqdHbTItGSJdAGqibJQhmRfCF7IN4beSF2G9CqnGXQrxofXU+EykllNeoczRgYytDKMubDIRK0g5MF8rE69cGu0u9nlUcqaUZ41W0qK2nGcSzr4D2wV9U9wxp1rnpxn8agXAOHMQ9cy9kbHM7ngY4gFb03TxrO/yfBUifTtXt78jCrjY/jgEFnMn45LuNWUtknuu7NSm7D3QEn3HbatV1Q2jvgIRf1sfODKQaeymxZoMLlTqsq1LF+HvaTqQOzEzUCfni0/eNIA+DfuE3KEtbsegckGmMktTXacnBHPVe687ugkpT+axCkkhBSyRSjWI2xf1KMMVmYiQdWksK9BEFiQoiYLIlvJA3/zeTzCejP0RbB6YPbhZuB+0pR3KcdX0LaJtju0ZgBL8Bd+sbz2QIaU2OfBX3BaQLsgZysQtrk0M8Sh1A0w3DyyYnGnAiZ4gqZ/TvI2A8OGd1YIbF7+F3P+B6dYpYdsJNZgrjO0UdOIhmom0nwL0pnfnzkL1803jAoKhvyAAAAAElFTkSuQmCC)](https://github.com/denosaurs/denon/blob/master/LICENSE)

denon is the [deno](https://deno.land/) replacement for [nodemon](https://nodemon.io/) 
providing a feature packed, highly configurable and easy to use experience.

denon does **not** require _any_ additional changes to your code or method of development. `denon` is a replacement wrapper for `deno`. To use `denon`,replace the word `deno` on the command line when executing your script.

## Features

Denon provides most of the features you would expect of a file watcher and more.

-   Automatically restart your deno projects
-   Drop-in replacement for `deno` executable
-   Extensive configuration options with script support
-   Configurable file watcher with support for filesystem events and directory walking
-   Ignoring specific files or directories with [glob](https://en.wikipedia.org/wiki/Glob_(programming)) patterns
-   Not limited to deno projects with a powerful script configuration

## Install

To install denon simply enter the following into a terminal:

#### deno.land

```bash
$ deno install --allow-read --allow-run --allow-write --allow-net -f -q --unstable https://deno.land/x/denon@2.3.1/denon.ts
```

#### nest.land

```bash
$ deno install --allow-read --allow-run --allow-write --allow-net -f -q --unstable https://x.nest.land/denon@2.3.1/denon.ts
```


> ⚠️ Make sure you are using `deno` version `^1.2.0` to install this executable. You can upgrade running `deno upgrade`.

## Usage

denon wraps your application, so you can pass all the arguments you would normally pass to your app:

```bash
$ denon run app.ts
```

you can pass arguments to deno:

```bash
$ denon run --allow-env app.ts
```

and even to your application:

```bash
$ denon run --allow-env app.ts --arg-for-my-app
```

you can run scripts declared in config:

```bash
$ denon [script name]
```

and you can see which scripts are available in your config:

```bash
$ denon
```

to see what else you can do with deno CLI use the help flag:

```bash
$ denon --help
```

## Autocompletion

In **zsh**, you can install autocompletion with:

```bash
echo '. <(denon --completion)' >> ~/.zshrc
```

In **bash**:

```bash
denon --completion >> ~/.config/denon.completion.sh
echo 'source ~/.config/denon.completion.sh' >> ~/.bash_profile
```

In **fish**:

```bash
echo 'denon --completion-fish | source' >> ~/.config/fish/config.fish
```

## Configuration

denon is designed to be simple but also extremely configurable to fit your project needs. It supports both json and yaml for the configuration file. The configuration options in yaml is the same as json making it compatible.

to create a basic configuration in the root directory of your project file you can run:

```bash
$ denon --init
```

this will create a basic `denon.json` file:

```jsonc
{
  "scripts": {
    "start": "app.js"
  }
}
```

you can also initialize from a custom template 
(see [templates/](https://github.com/denosaurs/denon/tree/master/templates) folder for all the available templates)

```bash
$ denon --init typescript
```

### JSON config (`denon.json` template)

Denon configuration can be provided as a JSON file:

```jsonc
{
  // optional but highly recommended
  "$schema": "https://deno.land/x/denon/schema.json",

  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "run my app.ts file"
    }
  }
}
```

#### JSON Schema

You can use a JSON schema to have type checking on your configuration. Simply add:

```jsonc
{
  "$schema": "https://deno.land/x/denon/schema.json",
  "scripts": { /* */ }
}
```

### YAML Configuration (`denon.yml` template)

Denon configuration can be provided as a YAML file:

```yaml
scripts:
  start:
    cmd: "deno run app.ts"
    desc: "run my app.ts file"
```

### Typescript config (`denon.config.ts` template)

Denon configuration can be provided as a `.config.ts` file:

```typescript
import { DenonConfig } from "https://deno.land/x/denon/mod.ts";

const config: DenonConfig = {
  scripts: {
    start: {
      cmd: "deno run app.ts",
      desc: "run my app.ts file",
    },
  },
};

export default config;
```

You can use a typescript configuration file to have programmable configuration
based on your environment (for example loading a `.env` file):

```typescript
import { DenonConfig } from "https://deno.land/x/denon/mod.ts";
import { config as env } from "https://deno.land/x/dotenv/mod.ts";

const config: DenonConfig = {
  scripts: {
    // same as json configuration
    start: {
      cmd: "app.js",
      desc: "Run my webserver",
      env: env()
    },
  },
};

export default config;
```

### Available options

denon takes inspiration from the awesome [velociraptor](https://github.com/umbopepato/velociraptor) module in the way it handles scripts.

#### Scripts

Scripts are declared inside the `scripts` object and are identified by a name:

```jsonc
{
  "scripts": {
    // they all resolve to `deno run app.ts` when you run `denon start`
    "start": "app.ts",
    // OR
    "start": "run app.ts",
    // OR
    "start": "deno run app.ts"
  }
}
```

Scripts can also be defined by a complex object:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      // with an optional description that
      // is shown when you run `denon` to list
      // all the scripts
      "desc": "Run the main server.",

      // available options...
      // they are described in the next paragraph
      "allow": [
        "env",
        "write",
      ],
      "unstable": true

      // running `denon start` will resolve in
      // deno run --allow-env --allow-write --unstable app.ts
    }
  }
}
```

### Script Options

Options can be script specific or be declared as global in the root of the config file.

#### Environment variables

Environment variables can be provided as an object and are passed directly to the child process.

```jsonc
{
  // globally applied to all scripts
  "env": {
    "TOKEN": "SUPER SECRET TOKEN",
  },

  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "env": {
        "PORT": 3000
      }
    }
  }
}
```

#### Permissions

Permission can be granted to child processes. You can provide specific permissions for each script,
but you can also declare permissions globally, following the same format.

```jsonc
{
  // globally applied to all scripts
  // as object ...
  "allow": {
    "read": "/etc,/tmp", // --allow-read=/etc,/tmp
    "env": true     // --allow-env
  },
  // ... or as array
  "allow": [
    "run", // --allow-run
    "net" // --allow-net
  ]

  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",
      
      // specific for a single script
      // as object ...
      "allow": {
        "read": "/etc,/tmp", // --allow-read=/etc,/tmp
        "env": true     // --allow-env
      },
      // ... or as array
      "allow": [
        "run", // --allow-run
        "net" // --allow-net
      ]
    }
  }
}
```

#### File watching

While file watching is a core feature of `denon` you always have the option
of disabling file watching and run a script only once:

```jsonc
{
  // globally applied to all scripts
  // now denon will essentialy be a script runner
  "watch": false

  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",
      
      // you can still enable watch on a script-by-script basis
      "watch": true
    }
  }
}
```

#### Import Map

Load import map file. Take a look a at the [official docs](https://deno.land/manual/linking_to_external_code/import_maps) for additional info.

> ⚠️ This feature in unstable in the current version of the deno executable.

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "importmap": "importmap.json"
    }
  }
}
```

#### TS config

Load tsconfig.json configuration file:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "tsconfig": "tsconfig.json"
    }
  }
}
```

#### Unstable

Enable if the script is using unstable features of deno stdlib:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "unstable": true
    }
  }
}
```

#### Inspect and InspectBrk

Activate inspector on `host:port`. If `inspectBrk` is used the executions breaks at the start of the user script:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "inspect": "127.0.0.1:9229",
      // OR
      "inspectBrk": "127.0.0.1:9229"
    }
  }
}
```

#### Lockfile

Check the specified lock file:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "lock": "lock.json"
    }
  }
}
```

#### Cert

Load certificate authority from PEM encoded file:

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "cert": "cert.pem"
    }
  }
}
```

#### Log

Set log level: (possible values: `debug`, `info`)

```jsonc
{
  "scripts": {
    "start": {
      "cmd": "deno run app.ts",
      "desc": "Run the main server.",

      "log": "debug" // or "info"
    }
  }
}
```

### Watcher

File watcher options:

```jsonc
{
  "scripts": { /* */ },

  "watcher": {
    // The number of milliseconds after the last change.
    "interval": 350,
    // The file extensions that it will scan for.
    "exts": ["js", "jsx", "ts", "tsx", "json"],
    // The globs that it will scan for.
    "match": ["*.*"],
    // The globs that it will not scan for.
    "skip": ["*/.git/*"],
    // Use the legacy file monitoring algorithm. (walking)
    "legacy": false
  }
}
```

### Logger

Internal logger options:

```jsonc
{
  "scripts": { /* */ },

  "logger": {
    // Clear screen after every restart.
    "fullscreen": false,
    // Output only errors
    "quiet": false,
    // Output debug messages
    "debug": true,
  }
}
```

## Other

### Contribution

Pull request, issues and feedback are very welcome. Code style is formatted with `deno fmt` and commit messages are done following [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) spec.

### Licence

Copyright 2020-present, the denosaurs team. All rights reserved. MIT license.
